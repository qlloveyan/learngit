<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<style type="text/css">
.mytable {
	background: white;
	border-collapse: separate;
	border-spacing: 0pt;
	border: 1px solid black;
}

.myTD {
	background: white;
	border: solid 1pt;
	horizontal-align: right;
}
</style>

<script type="text/javascript">
	var servicedivsion = "http://ditu.zj.cn/services/divisionsearch"
</script>
<script type="text/javascript"
	src="http://ditu.zj.cn/services/JS/jsr_class.js"></script>
<script type="text/javascript">
	stringify = function(obj) {
		var t = typeof (obj);
		if (t != "object" || obj === null) {
			// simple data type
			if (t == "string")
				obj = '"' + obj + '"';
			return String(obj);
		} else {
			// recurse array or object
			var n, v, json = [], arr = (obj && obj.constructor == Array);
			for (n in obj) {
				v = obj[n];
				t = typeof (v);
				if (t == "string")
					v = '"' + v + '"';
				else if (t == "object" && v !== null)
					v = stringify(v);
				json.push((arr ? "" : '"' + n + '":') + String(v));
			}
			return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
		}
	};
	function filterHtml(str) {
		str = str.replace(/<\/?[^>]*>/g, ""); //去除HTML tag
		str.value = str.replace(/[ | ]*\n/g, '\n'); //去除行尾空白
		//str = str.replace(/\n[\s| | ]*\r/g,’\n’); //去除多余空行
		return str;
	}
	function hasnum(theNum) {
		var returnflag = false;
		for (var i = 0; i < theNum.length; i++) {
			oneNum = theNum.substring(i, i + 1);
			if (oneNum >= "0" && oneNum <= "9") {
				returnflag = true;
				break;
			}
		}
		return returnflag;
	}
	function test() {
		document.getElementById('infodiv').innerHTML = '';
		document.getElementById("results").innerHTML = "";
		document.getElementById("cresults").innerHTML = '';

		var req = servicedivsion
				+ "?query="
				+ encodeURI(filterHtml(document.getElementById("search4").value))
				+ "&callback=showresult";//&divisiontype="+document.getElementById('Text2').value;
		bObj = new JSONscriptRequest(req);
		bObj.buildScriptTag();
		bObj.addScriptTag();
	}
	function showresult(response) {
		var responseArray = response;
		var contentHtml = ''
		if ( !('result' in responseArray) || responseArray.result.length == 0) {
			contentHtml = '无相应信息!';
		} else {
			contentHtml = "showresult(" + stringify(response) + ")";
		}
		document.getElementById('infodiv').innerHTML = contentHtml;
		var parent = response.result;
		if (parent == null) {
			document.getElementById("results").innerHTML = "查询结果为空";
			return;
		}
		var str = "";
		str = '<table class="mytable"><tbody><tr><td>名称</td><td>labelx</td><td>labley</td></tr>';
		str += "<tr><td>" + parent.NAME + "</td>";
		str += "<td>" + parent.LABELX + "</td>";
		str += "<td>" + parent.LABELY + "</td></tr>";
		str += "</tbody></table>";
		document.getElementById("results").innerHTML = str;
		str = '<table class="mytable"><tbody><tr><td>名称</td><td>labelx</td><td>labley</td></tr>';
		var childrens = parent.children;
		for (var i = 0; i < childrens.length; i++) {
			var result = childrens[i];
			str += "<tr><td>" + result.NAME + "</td>";
			str += "<td>" + result.LABELX + "</td>";
			str += "<td>" + result.LABELY + "</td></tr>";
		}
		str += "</tbody></table>";
		document.getElementById("cresults").innerHTML = str;
	}
	function searchKeyPress(e) {
		// look for window.event in case event isn't passed in
		if (window.event) {
			e = window.event;
		}
		if (e.keyCode == 13) {
			document.getElementById('mybutton').click();
			return false;
		}
	}
</script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>行政区划查询</title>
</head>
<body>
	<h1>行政区划二次开发示例</h1>
	<div style="valign: middle">
		<table>
			<tr>
				<td>输入行政区划名(Example：浙江省)</td>
			</tr>
		</table>
		<table width="100%">
			<tr>
				<td><input style="width: 600px; height: 30px; font-size: 20px;"
					type="text" id="search4" onkeypress="searchKeyPress(event);" /></td>
				<td
					style="width: 120px; height: 53px; margin-left: 0; margin-right: 0;"><div
						id="searchbutton">
						<input id="mybutton" type="button" style="height: 40px;"
							value="区域查询" onclick="test();" />
					</div></td>


				<td style="margin-left: 0; margin-right: 0; width: 100%;"
					aligh="left"></td>
			</tr>
		</table>
	</div>
	<div id="results"></div>
	<div id="cresults"></div>
	<div id="infodiv" style="width: 400px; height: 400px;"></div>
</body>
</html>
